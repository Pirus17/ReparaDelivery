<script>
    const formulario = document.getElementById('formulario'); //importa formulario del html
    const inputs = document.querySelectorAll('#formulario input');//importa todos los inputs del formulario
    

    //arreglo de expresiones regulares para validar el formulario
    const expresiones = {
        email: /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,
        contrasenia: /^(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8}$/, // 4 a 8 caracteres, al menos una mayúscula y un número.
        nombre: /^[a-zA-Z\s]{1,40}$/, // Letras y espacios, pueden llevar acentos.
        apellido: /^[a-zA-ZÀ-ÿ\s]{1,40}$/, // Letras y espacios, pueden llevar acentos.
        direccion: /^[a-zA-Z\d\s]{1,100}$/, // Letras, números y espacios, pueden llevar acentos.
        numero: /^\d{1,10}$/, // Solo números, hasta 10 dígitos.
        barrio: /^[a-zA-Z\d\s]{1,30}$/, // Letras, números y espacios, pueden llevar acentos.
        provincia: /Santiago del Estero/, // Por el momento Santiago del Estero nomás es válida.
        numeroTelefono: /^\d{1,40}$/ // 1 a 20 números.
    };

    // arreglo de mensajes de error 
    const mensajes = {
        email: "Formato correo electrónico incorrecto.",
        contrasenia: "La contraseña debe tener por lo menos una mayúscula, un número y como máximo 8 caracteres.",
        nombre: "Debe contener el/los nombre/s.",
        apellido: "Debe contener el/los apellido/s.",
        direccion: "Debe contener la calle o manzana y lote.",
        numero: "Debe contener solo números.",
        barrio: "Debe contener el barrio.",
        provincia: "Debe seleccionar la provincia.",
        numeroTelefono: "Debe contener el número sin el 15"
    }

    //arreglo que contiene los campos del formulario para evaluar si tiene error el campo
    const campos = {
        email: false,
        contrasenia: false,
        nombre: false,
        apellido: false,
        direccion: false,
        numero: false,
        barrio: false,
        provincia: true,
        numeroTelefono: false
    }

    //validacion del formulario llamando a la validacion de cada campo 
    const validarFormulario = (e) => {
        switch (e.target.name) {
            case "email":
                validarCampo(expresiones.email, e.target, 'email', mensajes.email);
                break;
            case "contrasenia":
                validarCampo(expresiones.contrasenia, e.target, 'contrasenia', mensajes.contrasenia);
                break;
            case "nombre":
                validarCampo(expresiones.nombre, e.target, 'nombre', mensajes.nombre);
                break;
            case "apellido":
                validarCampo(expresiones.apellido, e.target, 'apellido', mensajes.apellido);
                break;
            case "direccion":
                validarCampo(expresiones.direccion, e.target, 'direccion', mensajes.direccion);
                break;
            case "numero":
                validarCampo(expresiones.numero, e.target, 'numero', mensajes.numero);
                break;
            case "barrio":
                validarCampo(expresiones.barrio, e.target, 'barrio', mensajes.barrio);
                break;
            case "provincia":
                validarCampo(expresiones.provincia, e.target, 'provincia', mensajes.provincia);
                break;
            case "numeroTelefono":
                validarCampo(expresiones.numeroTelefono, e.target, 'numeroTelefono', mensajes.numeroTelefono);
                break;
        }
    }

    // Funciona para validar cada campo
    const validarCampo = (expresion, input, campo, mensaje) => {
        const mensajeError = document.getElementById(`mensaje-${campo}`);
        if (expresion.test(input.value)) {
            mensajeError.textContent = ''; // Si el formato es válido, borra el mensaje de error
            document.getElementById(`grupo__${campo}`).classList.remove('formulario__grupo-incorrecto');
            document.getElementById(`grupo__${campo}`).classList.add('formulario__grupo-correcto');
            campos[campo] = true;
        } else {
            mensajeError.textContent = mensaje;
            document.getElementById(`grupo__${campo}`).classList.add('formulario__grupo-incorrecto');
            document.getElementById(`grupo__${campo}`).classList.remove('formulario__grupo-correcto');
            campos[campo] = false;
        }

    }

    //maneja el ingreso del teclado para validar el formulario
    inputs.forEach((input) => {
        input.addEventListener('keyup', validarFormulario);
        input.addEventListener('blur', validarFormulario);
    });

    //maneja el evento del boton submit del formulario
    formulario.addEventListener('submit', (e) => {
        e.preventDefault();// detiene el submit para realizar la verificacion
        
        //obtiene elvalor del select provincia
        const provincia = document.getElementById(`inputGroupSelect02`).value; 
        const mensajeError = document.getElementById('mensaje-datosCorrectos');
        
        //compara todos los valores de verdad del arreglo campos
        const todosCamposTrue = Object.values(campos).every(valor => valor === true);
        if (todosCamposTrue) {
            if (provincia !== "Elegir...") {
                e.currentTarget.submit(); //luego de validar envia el formulario al controlador
            } else {
                mensajeError.textContent = "Elegir la Provincia";
            }

        } else {
            mensajeError.textContent = "Completar todos los datos";
        }

    });

</script>